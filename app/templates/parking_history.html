<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Parking History</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light d-flex flex-column min-vh-100">
    <header>
      <div
        class="container-fluid d-flex align-items-center pt-4 ps-4 pb-4"
        style="background-color: var(--bs-gray-200)"
      >
        <img
          src="{{ url_for('static', filename='logo.png') }}"
          class="img-fluid"
          alt="App Logo"
          style="max-width: 100px; border-radius: 50%"
        />
        <div class="ps-2 pt-2">
          <h2
            style="
              color: rgba(23, 1, 21, 0.826);
              font-family: 'Poppins', sans-serif;
              font-style: italic;
            "
          >
            ParkPal
          </h2>
        </div>
        <div class="ms-auto">
          <a
            href="{{ url_for('dashboard.user') }}"
            class="btn btn-light me-2 border-dark"
            >Dashboard
          </a>
          <a href="{{ url_for('authentication.logout') }}" class="btn btn-dark"
            >Logout</a
          >
        </div>
      </div>
    </header>
    <main class="flex-grow-1">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ category }} alert-dismissible fade show mt-3"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endfor %} {% endif %} {% endwith %}
      <div class="container mt-5">
        <h2 class="mb-4 text-center">Your Parking History</h2>

        {% if history %}
        <table class="table table-bordered table-striped">
          <thead class="table-dark">
            <tr>
              <th>Spot ID</th>
              <th>Lot Name</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Status</th>
              <th>Duration (hrs)</th>
              <th>Cost (₹)</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in history %}
            <tr>
              <td>{{ entry.reservation.spot.id }}</td>
              <td>{{ entry.reservation.spot.lot.location_name }}</td>
              <td>
                {% if entry.reservation.start_time %} {{
                entry.reservation.start_time.strftime('%Y-%m-%d %H:%M:%S') }}
                {%else%} - {% endif %}
              </td>
              <td>
                {% if entry.reservation.end_time %} {{
                entry.reservation.end_time.strftime('%Y-%m-%d %H:%M:%S') }}
                {%else%} - {% endif %}
              </td>
              <td>{{ entry.reservation.status }}</td>
              <td>
                {% if entry.duration is not none %} {{ entry.duration }} hrs {%
                else %} Not Occupied {% endif %}
              </td>
              <td>
                {% if entry.cost is not none %} ₹{{ entry.cost }} {% else %} ₹0
                {% endif %}
              </td>
              <td>
                {% if entry.reservation.status == 'active' and not
                entry.reservation.start_time %}
                <form
                  action="{{ url_for('user.occupy_spot', reservation_id=entry.reservation.id) }}"
                  method="POST"
                  style="display: inline"
                >
                  <button type="submit" class="btn btn-success btn-sm">
                    Occupy
                  </button>
                </form>
                {% else %}
                <button class="btn btn-secondary" disabled>
                  Occupied/Checked out
                </button>
                {% endif %} {% if entry.reservation.status == 'active' %}
                <form
                  action="{{ url_for('user.release_spot', reservation_id=entry.reservation.id) }}"
                  method="POST"
                  style="display: inline"
                >
                  <button type="submit" class="btn btn-danger btn-sm">
                    Release Spot
                  </button>
                </form>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="mb-3 text-start">
          <a
            href="{{ url_for('user.view_lots') }}"
            class="btn btn-light border-dark"
          >
            Back to Available Lots</a
          >
        </div>
        {% else %}
        <p class="text-center">You have no parking reservations yet.</p>
        {% endif %}
      </div>
    </main>
    <footer class="py-4" style="background-color: rgba(23, 1, 21, 0.533)" ;>
      <div
        class="container d-flex justify-content-between align-items-center flex-wrap"
      >
        <div>
          <p class="mb-1">Mail us here:</p>
          <a
            href="mailto:parkpal@mail.com"
            class="text-muted text-decoration-none"
          >
            parkpal@mail.com
          </a>
        </div>
        <div class="text-end">
          <p class="mb-0 text-muted">&copy; 2025 All rights reserved.</p>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
