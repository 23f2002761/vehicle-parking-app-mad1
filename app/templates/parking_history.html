<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Parking History</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="mb-4 text-center">Your Parking History</h2>

      {% if history %}
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Spot ID</th>
            <th>Lot Name</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Status</th>
            <th>Duration (hrs)</th>
            <th>Cost (₹)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in history %}
          <tr>
            <td>{{ entry.reservation.spot.id }}</td>
            <td>{{ entry.reservation.spot.lot.location_name }}</td>
            <td>
              {% if entry.reservation.start_time %} {{
              entry.reservation.start_time.strftime('%Y-%m-%d %H:%M:%S') }}
              {%else%} - {% endif %}
            </td>
            <td>
              {% if entry.reservation.end_time %} {{
              entry.reservation.end_time.strftime('%Y-%m-%d %H:%M:%S') }}
              {%else%} - {% endif %}
            </td>
            <td>{{ entry.reservation.status }}</td>
            <td>
              {% if entry.duration %} {{ entry.duration }} {% else %} - {% endif
              %}
            </td>
            <td>
              {% if entry.cost %} ₹{{ entry.cost }} {% else %} - {% endif %}
            </td>
            <td>
              {% if entry.reservation.status == 'active' and not
              entry.reservation.start_time %}
              <form
                action="{{ url_for('user.occupy_spot', reservation_id=entry.reservation.id) }}"
                method="POST"
                style="display: inline"
              >
                <button type="submit" class="btn btn-success btn-sm">
                  Occupy
                </button>
              </form>
              {% else %}
              <button class="btn btn-secondary" disabled>Occupied</button>
              {% endif %} {% if entry.reservation.status == 'active' %}
              <form
                action="{{ url_for('user.release_spot', reservation_id=entry.reservation.id) }}"
                method="POST"
                style="display: inline"
              >
                <button type="submit" class="btn btn-danger btn-sm">
                  Release Spot
                </button>
              </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="mb-3 text-start">
        <a href="{{ url_for('user.view_lots') }}" class="btn btn-secondary"
          >← Back to Available Lots</a
        >
      </div>
      {% else %}
      <p class="text-center">You have no parking reservations yet.</p>
      {% endif %}
    </div>
  </body>
</html>
